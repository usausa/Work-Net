# WorkSlack — 機能一覧と強化ポイント

## 実装済み機能

### レイアウト / 構造
- [x] Slackライクな4ペインレイアウト（ワークスペースバー + サイドバー + メインコンテンツ + サイドパネル）
- [x] 全画面ビューポート（100vh × 100vw）
- [x] サイドバー固定幅 260px + メインコンテンツ可変幅
- [x] ワークスペースアイコンバー（左端56px、Home/DMs/Activity/More + Add workspace）
- [x] レスポンシブ対応（1024px以下: ワークスペースバー縮小、768px以下: 非表示、640px以下: サイドバー非表示）

### サイドバー（Sidebar）
- [x] ダークパープル背景（#3f0e40）のSlackカラースキーム
- [x] ワークスペース名 & 現在のユーザー名表示
- [x] 新規メッセージ作成ボタン（compose） — モーダルダイアログ
- [x] ナビゲーションショートカット（Threads, Drafts, Saved items） — 各モーダル表示
- [x] チャンネル一覧（#プレフィックス付き）
- [x] ダイレクトメッセージ一覧（アバター + ステータス付き）
- [x] セクションの折りたたみ/展開（Channels, Direct messages）
- [x] アクティブチャンネルのハイライト表示
- [x] 「Add channels」モーダル（チャンネル名 + 説明入力）
- [x] 「Add teammates」モーダル（ユーザー一覧表示）
- [x] 未読メッセージバッジ（赤バッジ + 未読チャンネル太字化）
- [x] サイドバー検索バー（チャンネル/DMのリアルタイムフィルタリング）
- [x] カスタムステータス設定UI（プリセット選択 + カスタム入力 + クリア）

### チャンネルビュー（ChannelView）
- [x] チャンネルヘッダー（名前 + トピック + メンバー数 + ピン留め数）
- [x] チャンネル/DM切替時のイントロメッセージ
- [x] メッセージ一覧のスクロール表示
- [x] メッセージ送信後の自動スクロール
- [x] チャンネル別プレースホルダー（"Message #general" 等）
- [x] 日付区切り線（Today / Yesterday / 日付ラベル）
- [x] タイピングインジケーター（メッセージ送信後にランダムユーザーの typing... アニメーション表示）
- [x] メッセージ検索サイドパネル（キーワード検索 + 結果表示）
- [x] メンバー一覧サイドパネル（アバター + 名前 + カスタムステータス絵文字）
- [x] ピン留めメッセージサイドパネル（ピン留めされたメッセージ一覧表示）
- [x] ユーザープロフィールカード（アバター名クリックでポップアップ表示）

### メッセージ表示（MessageItem）
- [x] アバター + 著者名 + タイムスタンプのヘッダー
- [x] 同一著者の連続メッセージのグルーピング（5分以内）
- [x] グループ内メッセージのホバー時タイムスタンプ表示
- [x] 今日/昨日/日付のタイムスタンプフォーマット
- [x] 絵文字リアクションチップ（カウント付き + 「+」追加ボタン）
- [x] 自分のリアクションのアクティブ表示
- [x] リアクションのクリックによるトグル（追加/解除）
- [x] ホバー時アクションツールバー（😀リアクション / 💬スレッド / 🔖ブックマーク / ⋯メニュー）
- [x] メッセージ編集（インラインテキストエリア + Enter保存 / Escape取消）
- [x] メッセージ削除
- [x] 編集済みバッジ（edited）
- [x] ピン留めバッジ（📌 Pinned）
- [x] ピン留め/解除（⋯メニューから全ユーザーが操作可能）
- [x] ブックマーク（🔖ボタンでトグル、アクティブ状態の視覚表示）
- [x] Markdown/書式レンダリング（*bold*, _italic_, ~strikethrough~, `code`, ```codeblock```, > blockquote, URL自動リンク, @mention ハイライト）
- [x] スレッド返信数リンク（💬 N replies）

### スレッド（Thread）
- [x] メッセージクリックで右サイドパネル表示
- [x] 親メッセージ + 返信一覧 + 返信入力
- [x] 返信数カウント表示

### メッセージ入力（MessageInput）
- [x] フォーマットツールバー（Bold, Italic, Strikethrough, Code, Quote）
- [x] テキストエリア（プレースホルダー付き）
- [x] フッターアクション（📎添付 / 😊絵文字ピッカー / ＠メンション）
- [x] 送信ボタン（入力空時は無効化）
- [x] Enterキーで送信、Shift+Enterで改行
- [x] 絵文字ピッカー連携（カテゴリ / 検索 / クリック挿入）
- [x] 添付ファイルダイアログ（ドロップゾーンUI）

### ユーザーアバター（UserAvatar）
- [x] カラー背景 + イニシャル表示
- [x] 3サイズ対応（Small / Medium / Large）
- [x] オンラインステータスインジケーター（Online / Away / DND / Offline）

### キーボードショートカット
- [x] Ctrl+K / Cmd+K — サイドバー検索にフォーカス

### サウンド
- [x] メッセージ送信サウンド（Web Audio API — 400→800Hz ascending pop, 100ms）

### データ層（Services / Models）
- [x] IChatService インターフェースによるサービス分離
- [x] インメモリ実装（ChatService）& シードデータ
- [x] 6ユーザー、5チャンネル、3 DM、30+ メッセージ
- [x] メッセージ送信 / 編集 / 削除
- [x] リアクション追加 / 解除 / トグル
- [x] スレッド返信 / 返信数カウント
- [x] メッセージ検索（全文、最新20件）
- [x] 既読管理（GetUnreadCount / MarkAsRead）
- [x] カスタムステータス設定（SetCustomStatus）
- [x] ブックマーク（ToggleBookmark / IsBookmarked / GetBookmarkedMessages）
- [x] ピン留め（PinMessage / UnpinMessage / GetPinnedMessages）
- [x] Singleton DI 登録

---

## 未実装機能

> 難易度: ★1（数行・即実装可） ～ ★5（大規模リファクタ・外部連携）

### UI / UX — 中優先度
- [ ] **サイドバーのリサイズ** ★3 — ドラッグによるサイドバー幅の調整。JS interop で mousedown/mousemove/mouseup を処理し、CSS custom property でサイドバー幅を動的変更する必要がある
- [ ] **メッセージ内のリンクプレビュー** ★4 — URLの埋め込みプレビュー（OGP）。サーバー側で HTTP fetch → HTML パース → OGP メタタグ抽出 → キャッシュ → プレビューカード UI が必要。外部サイトへのアクセスを伴うため複雑
- [ ] **@メンション候補サジェスト** ★3 — 入力中の@に対するユーザー名ドロップダウン。textarea 内のカーソル位置を JS で取得し、その座標にフィルタリングドロップダウンを配置する必要がある
- [ ] **ファイルアップロード実装** ★3 — 実際のファイル選択 & プレビュー表示。Blazor の InputFile コンポーネント + DataURL 変換 + ChatMessage モデルに添付ファイル情報を追加 + プレビュー描画

### UI / UX — 低優先度
- [ ] **ダークモード** ★3 — カラースキームの切替対応。100箇所以上のハードコードされた色値を CSS custom properties にリファクタし、`[data-theme="dark"]` で切替可能にする
- [x] **通知音（メッセージ送信時）** ★1 — Web Audio API による送信サウンド。400→800Hz のアセンディング pop（100ms）を再生 ✅ 実装済み
- [ ] **デスクトップ通知（メッセージ受信時）** ★3 — Browser Notification API + 受信時サウンド。リアルタイムイベント基盤（SignalR）が前提のため、単体では実装困難
- [ ] **メッセージのVirtualization** ★4 — 大量メッセージ時のパフォーマンス最適化。可変高のメッセージ + グルーピング + 日付区切り線があるため、Blazor の `Virtualize<T>` をそのまま適用できず、カスタムの仮想スクロール実装が必要
- [ ] **カスタム絵文字** ★3 — ワークスペース独自の絵文字登録。絵文字モデル定義 + アップロード/登録 UI + EmojiPicker への統合 + MessageFormatter のレンダリング拡張

### データ / バックエンド
- [ ] **リアルタイム更新（SignalR）** ★4 — 他ユーザーのメッセージ/リアクションのリアルタイム反映。SignalR Hub 設計 + クライアント接続管理 + 再接続処理 + メッセージ/リアクション/タイピングの状態同期
- [ ] **永続化ストレージ** ★4 — DB/ファイルへのデータ保存。EF Core セットアップ + スキーマ設計 + マイグレーション + ChatService のインメモリ → DB バック実装への全面書換え
- [ ] **認証/認可** ★5 — ユーザーログイン機能。ASP.NET Core Identity 基盤構築 + Login/Register ページ + AuthenticationStateProvider + 全コンポーネントのユーザー切替対応。最も影響範囲が広い
- [ ] **メッセージページネーション** ★3 — 無限スクロールでの過去メッセージ遅延読み込み。JS interop でスクロール位置を検出 + ChatService にページング API 追加 + メッセージ追加時のスクロール位置維持
- [ ] **チャンネルメンバー管理** ★2 — チャンネル毎のメンバー追加/削除。ChatService に `Dictionary<string, HashSet<string>>` のメンバー辞書 + Add/Remove メソッド + 既存 Members パネルにボタン追加
