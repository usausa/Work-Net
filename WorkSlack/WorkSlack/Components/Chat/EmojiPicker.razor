<div class="emoji-picker-backdrop" @onclick="CloseAsync"></div>
<div class="emoji-picker">
    <div class="emoji-picker-search">
        <input type="text" placeholder="Search emoji..." @bind="_search" @bind:event="oninput" />
    </div>
    <div class="emoji-picker-header">
        @foreach (var cat in _categories)
        {
            <button class="emoji-cat-btn @(cat.Name == _activeCategory ? "emoji-cat-active" : "")"
                    @onclick="() => _activeCategory = cat.Name"
                    @onclick:stopPropagation="true"
                    title="@cat.Name">
                @cat.Icon
            </button>
        }
    </div>
    <div class="emoji-picker-body">
        @if (string.IsNullOrWhiteSpace(_search))
        {
            @foreach (var cat in _categories.Where(c => c.Name == _activeCategory))
            {
                <div class="emoji-cat-label">@cat.Name</div>
                <div class="emoji-grid">
                    @foreach (var emoji in cat.Emojis)
                    {
                        <button class="emoji-cell" @onclick="() => SelectAsync(emoji)" @onclick:stopPropagation="true" title="@emoji">@emoji</button>
                    }
                </div>
            }
        }
        else
        {
            <div class="emoji-cat-label">Search results</div>
            <div class="emoji-grid">
                @foreach (var emoji in _categories.SelectMany(c => c.Emojis).Distinct().Where(e => e.Contains(_search)))
                {
                    <button class="emoji-cell" @onclick="() => SelectAsync(emoji)" @onclick:stopPropagation="true" title="@emoji">@emoji</button>
                }
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public EventCallback<string> OnSelect { get; set; }

    [Parameter]
    public EventCallback OnClose { get; set; }

    private string _activeCategory = "Frequently Used";
    private string _search = "";

    private record EmojiCategory(string Name, string Icon, string[] Emojis);

    private static readonly EmojiCategory[] _categories =
    [
        new("Frequently Used", "ğŸ•", ["ğŸ‘", "â¤ï¸", "ğŸ˜‚", "ğŸ‰", "ğŸ‘€", "ğŸš€", "ğŸ’¯", "âœ…", "ğŸ”¥", "ğŸ‘", "ğŸ™Œ", "ğŸ’ª", "ğŸ™", "â­", "ğŸ’¡", "âœ¨"]),
        new("Smileys", "ğŸ˜€", ["ğŸ˜€", "ğŸ˜Š", "ğŸ˜„", "ğŸ˜", "ğŸ¤£", "ğŸ˜…", "ğŸ˜†", "ğŸ˜‰", "ğŸ˜", "ğŸ¥°", "ğŸ˜˜", "ğŸ˜‹", "ğŸ˜›", "ğŸ¤”", "ğŸ¤¨", "ğŸ˜", "ğŸ˜‘", "ğŸ™„", "ğŸ˜", "ğŸ˜¥", "ğŸ˜®", "ğŸ˜¯", "ğŸ˜´", "ğŸ¤¤", "ğŸ˜Œ", "ğŸ¤—", "ğŸ¤©", "ğŸ˜", "ğŸ¥³", "ğŸ˜¤", "ğŸ˜¡", "ğŸ¥º"]),
        new("People", "ğŸ‘‹", ["ğŸ‘‹", "ğŸ¤š", "âœ‹", "ğŸ‘Œ", "âœŒï¸", "ğŸ¤", "ğŸ¤Ÿ", "ğŸ¤˜", "ğŸ¤™", "ğŸ‘ˆ", "ğŸ‘‰", "ğŸ‘†", "ğŸ‘‡", "ğŸ‘", "ğŸ‘", "âœŠ", "ğŸ‘Š", "ğŸ¤›", "ğŸ¤œ", "ğŸ‘", "ğŸ™Œ", "ğŸ¤", "ğŸ™", "ğŸ’ª", "ğŸ¤·", "ğŸ¤¦", "ğŸ’", "ğŸ™‹", "ğŸ™†", "ğŸ™…"]),
        new("Nature", "ğŸŒ¿", ["ğŸŒ", "ğŸŒ™", "â­", "ğŸ”¥", "ğŸ’§", "ğŸŒŠ", "ğŸŒˆ", "â˜ï¸", "â›ˆï¸", "â„ï¸", "ğŸŒ¸", "ğŸŒº", "ğŸŒ»", "ğŸŒ¿", "ğŸ€", "ğŸƒ", "ğŸ±", "ğŸ¶", "ğŸ¼", "ğŸ¦Š", "ğŸ¦", "ğŸ¸", "ğŸ§", "ğŸ¦‹", "ğŸ"]),
        new("Food", "ğŸ”", ["ğŸ", "ğŸŠ", "ğŸ‹", "ğŸ‡", "ğŸ“", "ğŸ‘", "ğŸ¥‘", "ğŸ”", "ğŸ•", "ğŸœ", "ğŸ£", "ğŸ°", "ğŸ©", "ğŸª", "â˜•", "ğŸµ", "ğŸ§‹", "ğŸº", "ğŸ¥‚", "ğŸ§ƒ"]),
        new("Objects", "ğŸ’¼", ["â¤ï¸", "ğŸ’”", "ğŸ’¬", "ğŸ’­", "ğŸ“Œ", "ğŸ“", "âœï¸", "ğŸ“", "ğŸ“…", "â°", "ğŸ””", "ğŸ“¢", "ğŸ’»", "ğŸ“±", "ğŸ’¼", "ğŸ“§", "ğŸ“", "ğŸ—‚ï¸", "ğŸ“Š", "ğŸ“ˆ", "ğŸ”‘", "ğŸ”’", "ğŸ› ï¸", "âš™ï¸", "ğŸ¯", "ğŸ†", "ğŸ¨", "ğŸµ", "ğŸ“¸", "ğŸ¬"]),
    ];

    private async Task SelectAsync(string emoji)
    {
        await OnSelect.InvokeAsync(emoji);
        await OnClose.InvokeAsync();
    }

    private async Task CloseAsync()
    {
        await OnClose.InvokeAsync();
    }
}
