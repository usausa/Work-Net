@page "/"
@using WorkSlack.Components.Chat
@inject IJSRuntime JS

<PageTitle>Chat</PageTitle>

<div class="slack-app">
    <div class="workspace-bar">
        <div class="workspace-bar-icon" title="Chat">W</div>
        <div class="workspace-bar-nav">
            <button class="workspace-bar-btn ws-btn-active" title="Home">
                <span>üè†</span>
                <span class="workspace-bar-label">Home</span>
            </button>
            <button class="workspace-bar-btn" title="DMs">
                <span>üí¨</span>
                <span class="workspace-bar-label">DMs</span>
            </button>
            <button class="workspace-bar-btn" title="Activity">
                <span>üîî</span>
                <span class="workspace-bar-label">Activity</span>
            </button>
            <button class="workspace-bar-btn" title="More">
                <span>‚ãØ</span>
                <span class="workspace-bar-label">More</span>
            </button>
        </div>
        <div class="workspace-bar-divider"></div>
        <div class="workspace-bar-nav">
            <button class="workspace-bar-btn" title="Add workspace">
                <span>+</span>
            </button>
        </div>
    </div>
    <Sidebar SelectedChannelId="@_selectedChannelId" OnChannelSelected="HandleChannelSelected" />
    <main class="main-content">
        <ChannelView ChannelId="@_selectedChannelId" />
    </main>
</div>

@code {
    private string _selectedChannelId = "ch-general";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                await JS.InvokeVoidAsync("eval", """
                    document.addEventListener('keydown', function(e) {
                        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                            e.preventDefault();
                            var input = document.querySelector('.sidebar-search-box input');
                            if (input) input.focus();
                        }
                    });
                    """);
            }
            catch (JSDisconnectedException)
            {
                // Ignored during prerender
            }
        }
    }

    private void HandleChannelSelected(string channelId)
    {
        _selectedChannelId = channelId;
    }
}
